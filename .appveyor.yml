version: 1.0.{build}
pull_requests:
  do_not_increment_build_number: true
skip_tags: true
os: Visual Studio 2015
init:
  - cmd: rd /s /q %CHOCOLATEYINSTALL%
  - ps: iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))
install:
  - cinst cmake -y
  - set "PATH=%PATH%;C:\Program Files\CMake\bin"
  - cmake --version
  - .\.appveyor\remove_python27_from_path.bat
  - set "PATH=%PATH%;C:\Python35"
  - python --version
  - python -m pip install -U setuptools pip
  - python -m pip install EmPy
  - python -m pip install trollius
  - python -m pip install pyparsing
  - mkdir build
  - cd build
  - mkdir src
  - cd src
  - python -c "import shutil; shutil.copytree('../..', './class_loader', ignore=shutil.ignore_patterns('build'))"
  - git clone https://github.com/ros/console_bridge.git
  - git clone https://github.com/ros2/poco_vendor.git
  - mkdir ament
  - cd ament
  - git clone https://github.com/ament/ament_cmake.git
  - git clone https://github.com/ament/ament_package.git
  - git clone https://github.com/ament/ament_tools.git
  - git clone https://github.com/osrf/osrf_pycommon.git
  - git clone https://github.com/ament/googletest
  - cd ..\..\..
  - '"%VS140COMNTOOLS%\..\..\VC\vcvarsall.bat" x86_amd64'
  - set "PATH=%PATH%;C:\Python35"
build_script:
  - cd build
  - |
    python -u src\ament\ament_tools\scripts\ament.py build --build-tests
  - python -u src\ament\ament_tools\scripts\ament.py test --skip-build --skip-install --only class_loader
deploy: off
test: off
